<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login | Abhisarga 2020</title>
    <script>
        function init() {
            gapi.load('auth2', function () {
                auth2 = gapi.auth2.init({
                    client_id: '{{ google_client_id }}',
                    ux_mode: 'popup'
                });
                auth2.attachClickHandler(document.getElementById('google-sign-in-button'), {}, googleSignIn, signInFailed);
            });
        }

        function googleSignIn(googleUser) {
            let form = document.getElementById('google-sign-in-submit-form');
            alert(googleUser.getBasicProfile().getFamilyName());
            form.getElementsByTagName('input')[1].value = googleUser.getAuthResponse().id_token;
            form.submit();
        }

        function signInFailed(error) {
            alert(`Google Login Failed. (${error.error})`)
        }
    </script>
</head>
<body>
<form method="post">
    {% csrf_token %}
    <label for="user_email">Email:</label><input type="email" name="email" id="user_email">
    {% if error %}
        {{ error.email }}
    {% endif %}
    <br>
    <label for="user_password">Password:</label><input type="password" name="password" id="user_password">
    {% if error %}
        {{ error.password }}
    {% endif %}
    <br>
    <input type="submit" value="Submit">
</form>
<button id="google-sign-in-button">Login with Google</button>
<form style="display: none" id="google-sign-in-submit-form" method="post">
    {% csrf_token %}
    <input type="hidden" value="" name="google-id-token">
</form>
<script src="https://apis.google.com/js/platform.js?onload=init" async defer></script>
</body>
</html>